---
import "../styles/ModalModificarEvento.css";
---

<div id="modalNuevaReserva" class="modal">
  <div class="modal-contenido">
    <span class="cerrar" onclick="cerrarModal()">&times;</span>
    <div class="formulario-completo">
      <form
        class="formulario-modificar-registro"
        action="/modificar-evento"
        method="POST"
        id="formulario-modificar-reserva"
      >
        <div class="contenedor-superior">
          <p class="texto-centrado texto-rojo">Información General</p>

          <div class="contenedor-dato">
            <p class="texto-dato">Nombre</p>
            <div class="contenedor-input">
              <input type="text" class="input-dato" name="cedulaConductor" />
            </div>
          </div>

          <div class="contenedor-dato">
            <p class="texto-dato">Descripción</p>
            <div class="contenedor-input">
              <input type="text" class="input-dato" name="telefonoConductor" />
            </div>
          </div>

          <div class="contenedor-nombre">
            <div class="contenedor-dato">
              <p class="texto-dato">Categoría:</p>
              <div class="contenedor-input">
                <select name="categoria" class="input-dato">
                  <option value="Actual">Elija una Categoría</option>
                  <option value="curso">Curso</option>
                  <option value="congreso">Congreso</option>
                  <option value="webinar">Webinar</option>
                  <option value="conferencia">Conferencia</option>
                  <option value="socializacion">Socialización</option>
                </select>
              </div>
            </div>

            <div class="contenedor-dato">
              <p class="texto-dato">Área:</p>
              <div class="contenedor-input">
                <select name="area" class="input-dato">
                  <option value="Actual">Elija una Área</option>
                  <option value="activa">Práctica</option>
                  <option value="investigacion">Investigación</option>
                  <option value="academica">Academica</option>
                  <option value="tecnica">Técnica</option>
                  <option value="industrial">Industrial</option>
                  <option value="empresarial">Empresarial</option>
                  <option value="ia">IA</option>
                  <option value="redes">Redes</option>
                </select>
              </div>
            </div>
          </div>

          <div class="contenedor-dato">
            <p class="texto-dato">Asignación:</p>
            <div class="contenedor-input">
              <select name="estado" class="input-dato">
                <option value="Actual">Elija una Asignación</option>
                <option value="General">Publico general</option>
                <option value="Especifica">Carrera específica</option>
                <option value="Facultad">Facultad</option>
              </select>
            </div>
          </div>
        </div>

        <div class="contenedor-superior">
          <p class="texto-centrado texto-rojo">Programación</p>
          <div class="contenedor-nombre">
            <div class="contenedor-dato">
              <p class="texto-dato">Fecha de Inicio:</p>
              <div class="contenedor-input">
                <input type="date" class="input-dato" name="fecha-inicio" />
              </div>
            </div>

            <div class="contenedor-dato">
              <p class="texto-dato">Hora de Inicio:</p>
              <div class="contenedor-input">
                <input type="time" class="input-dato" name="hora-inicio" />
              </div>
            </div>
          </div>

          <div class="contenedor-nombre">
            <div class="contenedor-dato">
              <p class="texto-dato">Fecha de Finalización:</p>
              <div class="contenedor-input">
                <input type="date" class="input-dato" name="fecha-fin" />
              </div>
            </div>

            <div class="contenedor-dato">
              <p class="texto-dato">Hora de Finalización:</p>
              <div class="contenedor-input">
                <input type="time" class="input-dato" name="hora-fin" />
              </div>
            </div>
          </div>

          <div class="contenedor-dato">
            <p class="texto-dato">Duración</p>
            <div class="contenedor-input">
              <input type="number" class="input-dato" name="duracion" />
            </div>
          </div>

          <div class="contenedor-dato">
            <p class="texto-dato">Ubicación</p>
            <div class="contenedor-input">
              <input type="text" class="input-dato" name="telefonoConductor" />
            </div>
          </div>
        </div>

        <div class="contenedor-inferior">
          <p class="texto-centrado texto-rojo">Organizador</p>
          <div class="contenedor-dato">
            <p class="texto-dato">Cédula</p>
            <div class="contenedor-input">
              <input type="text" class="input-dato" name="cedulaConductor" />
            </div>
          </div>

          <div class="contenedor-dato">
            <p class="texto-dato">Nombre</p>
            <p>
              Aquí va el nombre completo del organizador con su cargo si se
              desea
            </p>
          </div>

          <div class="contenedor-boton-modificar">
            <button
              type="button"
              class="boton-modificar"
              onclick="cerrarModal()">Cancelar</button
            >
            <button type="submit" class="boton-modificar">Guardar</button>
          </div>
        </div>
      </form>
      <div class="contenedor-imagen">
        <img
          id="nueva-evento-imagen"
          class="imagen-evento"
          style="display: none;"
          alt="Imagen del nuevo evento"
        />
        <div class="contenedor-file">
          <label for="file-upload" class="custom-file-upload">
            <img
              src="/img/CRUD/upload.png"
              alt="Subir imagen"
              class="upload-icon"
            />
            <span>Seleccionar imagen</span>
          </label>
          <input id="file-upload" type="file" class="input-file" />
          <p class="file-name">No se ha seleccionado ningún archivo</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    declare global {
      interface Window {
        abrirModalNuevo: (id: string) => void;
        cerrarModal: () => void;
      }
    }

    function abrirModalNuevo() {
      const modal = document.getElementById("modalNuevaReserva");
      if (modal) modal.style.display = "block";
    }

    function cerrarModal() {
      const modal = document.getElementById("modalNuevaReserva");
      const form = document.getElementById(
        "formulario-modificar-reserva"
      ) as HTMLFormElement | null;
      if (modal && form) {
        modal.style.display = "none";
        form.reset();
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const cerrar = document.querySelector("#modalNuevaReserva .cerrar");
      if (cerrar) cerrar.addEventListener("click", cerrarModal);
      window.abrirModalNuevo = abrirModalNuevo;
      window.cerrarModal = cerrarModal;
    });

    const fileInput = document.getElementById(
      "file-upload"
    ) as HTMLInputElement | null;
    const fileNameDisplay = document.querySelector(
      ".file-name"
    ) as HTMLElement | null;
    const nuevaEventoImagen = document.getElementById(
      "nueva-evento-imagen"
    ) as HTMLImageElement | null;

    if (fileInput && fileNameDisplay && nuevaEventoImagen) {
      fileInput.addEventListener("change", (e: Event) => {
        const target = e.target as HTMLInputElement;
        const file = target.files?.[0];

        if (file && file.type.match("image.*")) {
          // Mostrar el nombre del archivo
          fileNameDisplay.textContent = file.name;

          // Crear una URL temporal para la imagen
          const reader = new FileReader();

          reader.onload = (event) => {
            if (event.target?.result) {
              // Mostrar y configurar la imagen subida
              nuevaEventoImagen.src = event.target.result as string;
              nuevaEventoImagen.style.display = "block";
            }
          };

          reader.readAsDataURL(file);
        } else {
          fileNameDisplay.textContent =
            "No se ha seleccionado ningún archivo válido";
          nuevaEventoImagen.style.display = "none";
        }
      });
    }
  </script>
</div>
