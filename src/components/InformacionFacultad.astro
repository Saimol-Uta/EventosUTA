---
import TarjetaConImagen from "../components/ContenedorInfo.astro";
import "../styles/global.css";
import Evento from "../components/CardCarousel.astro";
import prisma from "@/db";
const {
  tituloFacultad,
  tituloDescripcion,
  contenidoDescripcion,
  imagenDescripcion,
  tituloMision,
  contenidoMision,
  imagenMision,
  tituloVision,
  contenidoVision,
  imagenVision,
  modoAdmin = false
} = Astro.props;

const eventosDestacados = await prisma.eventos.findMany({
  where: {
    es_destacado: true,
  },
  take: 6,
  orderBy: {
    fec_ini_eve: "desc",
  },
});

const slides = [];
for (let i = 0; i < eventosDestacados.length; i += 2) {
  slides.push(eventosDestacados.slice(i, i + 2));
}
---
<section class="py-12 bg-gray-50 text-center">
  <h2 class="text-3xl font-bold text-red-800 mb-10">Eventos Favoritos</h2>

  <div class="relative max-w-5xl mx-auto">
    <!-- Contenedor del carrusel -->
    <div id="carousel-container" class="overflow-hidden rounded-xl shadow-lg w-full">
      <div
        id="carousel-inner"
        class="flex transition-transform duration-700 ease-in-out"
        style="width: 100%;"
      >
        {slides.map((grupo, index) => (
          <div
            class="min-w-full flex justify-center gap-6 bg-white p-6"
            data-slide-index={index}
          >
            {grupo.map((evento) => (
              <Evento
                imagen={evento.img_eve}
                titulo={evento.nom_eve}
                estado={evento.id_asi_eve?.length?.toString() || "0"}
                horas={evento.dur_eve ?? 0}
                slug={evento.id_eve}
              />
            ))}
          </div>
        ))}
      </div>
    </div>

    <!-- Botones -->
    <div class="flex justify-between items-center mt-6 px-8">
      <button
        onclick="cambiarSlide(-1)"
        class="w-12 h-12 rounded-full bg-red-600 text-white flex items-center justify-center shadow-md hover:bg-red-700 transition-all"
        aria-label="Anterior"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <button
        onclick="cambiarSlide(1)"
        class="w-12 h-12 rounded-full bg-red-600 text-white flex items-center justify-center shadow-md hover:bg-red-700 transition-all"
        aria-label="Siguiente"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>

    <!-- Indicadores -->
    <div id="carousel-indicators" class="flex justify-center gap-2 mt-4">
      {slides.map((_, index) => (
        <div
          class="w-3 h-3 rounded-full bg-gray-400 transition-all duration-300"
          data-indicator-index={index}
        ></div>
      ))}
    </div>

    <!-- Botón Ver más -->
    <div class="mt-10">
      <a
        href="/cursosCompleto"
        class="group inline-flex items-center gap-3 px-6 py-3 rounded-full bg-red-600 text-white font-semibold shadow-md hover:bg-red-700 transition"
      >
        Ver más
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5 transition-transform duration-300 group-hover:translate-x-1"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
      </a>
    </div>
  </div>
</section>

    <TarjetaConImagen
      titulo={tituloDescripcion}
      contenido={contenidoDescripcion}
      imagenUrl={imagenDescripcion}
      columna="des_pag"
      modoEdicion={modoAdmin} 
    />

    <TarjetaConImagen
      titulo={tituloMision}
      contenido={contenidoMision}
      imagenUrl={imagenMision}
      invertir={true}
      columna="mis_pag"
      modoEdicion={modoAdmin}
    />

    <TarjetaConImagen
      titulo={tituloVision}
      contenido={contenidoVision}
      imagenUrl={imagenVision}
      columna="vis_pag"
      modoEdicion={modoAdmin}
    />
  </div>
</div>

<script src="/js/eventosFavoritos.js" defer is:inline></script>
