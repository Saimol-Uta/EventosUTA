---
import { actions } from "astro:actions";

const {
  titulo,
  contenido,
  imagenUrl,
  invertir = false,
  modoEdicion = false,
  columna,
} = Astro.props;

const result = Astro.getActionResult(actions.updatePaginaPrincipal);
---

<section
  class="relative w-full bg-cover bg-center py-16 px-6 lg:px-24 text-white"
  style={`background-image: url('${imagenUrl}');`}
>
  <!-- Capa oscura encima de la imagen -->
  <div class="absolute inset-0 bg-black/50"></div>

  <div
    class={`relative z-10 max-w-6xl mx-auto flex flex-col ${
      invertir ? "lg:flex-row-reverse" : "lg:flex-row"
    } items-center gap-12`}
  >
    <!-- Texto -->
    <div class="w-full text-center lg:text-left space-y-6">
      <form
        action={actions.updatePaginaPrincipal}
        method="post"
        enctype="multipart/form-data"
        class="flex flex-col gap-4 items-center lg:items-start"
      >
  <h2 class="text-4xl lg:text-5xl font-extrabold drop-shadow-lg">
  {titulo}
</h2>
        {modoEdicion ? (
          <>
            <textarea
              id={`contenido-${columna}`}
              name={columna}
              class="w-full bg-transparent p-2 text-lg focus:outline-none resize-none placeholder:text-gray-300 border-b border-white text-white drop-shadow"
              rows="6"
              required
              placeholder="Escribe algo"
            >{contenido}</textarea>

            <button
              type="submit"
           class="bg-gradient-to-r from-red-700 via-red-800 to-red-900 text-white text-sm px-5 py-2.5 rounded-full shadow-md hover:shadow-lg hover:from-red-600 hover:to-red-800 transition-all duration-300 font-semibold tracking-wide"
            >
              Guardar Contenido
            </button>
          </>
        ) : (
          <p class="text-lg leading-relaxed whitespace-pre-line drop-shadow-lg">
            {contenido}
          </p>
        )}

        {result?.data?.success === false && (
          <p class="text-red-400 text-sm mt-1">{result?.data?.error}</p>
        )}
        {result?.data?.success === true && (
          <p class="text-green-300 text-sm mt-1">{result?.data?.message}</p>
        )}
      </form>
    </div>

    <!-- EdiciÃ³n imagen -->
    {modoEdicion && (
      <div class="w-full max-w-sm">
        <form
          action={actions.updatePaginaPrincipal}
          method="post"
          enctype="multipart/form-data"
          class="flex flex-col items-center gap-4"
        >
         <div class="group relative cursor-pointer text-sm text-white">
  <span
    class="absolute left-0 -bottom-0.5 h-0.5 w-0 bg-white transition-all duration-300 group-hover:w-full"
  ></span>
</div>
     <input
  type="file"
  id="input-imagen"
  name="imagen"
  accept="image/jpeg, image/png"
  class="hidden"
  onchange="mostrarNombreArchivo(this)"
/>

<button
  type="button"
  onclick="document.getElementById('input-imagen').click()"
  class="bg-gradient-to-r from-red-700 via-red-800 to-red-900 text-white text-sm px-5 py-2.5 rounded-full shadow-md hover:shadow-lg hover:from-red-600 hover:to-red-800 transition-all duration-300 font-semibold tracking-wide"
>
  Seleccionar imagen
</button>

<p id="nombre-archivo" class="text-sm text-white text-center italic"></p>

<button
  type="submit"
  id="btn-guardar-imagen"
  class="bg-gradient-to-r from-red-700 via-red-800 to-red-900 text-white text-sm px-5 py-2.5 rounded-full shadow-md hover:shadow-lg hover:from-red-600 hover:to-red-800 transition-all duration-300 font-semibold tracking-wide hidden"
>
  Guardar imagen
</button>
        </form>
      </div>
    )}
  </div>
</section>
<script type="module">
  window.mostrarNombreArchivo = function (input) {
    const label = document.getElementById("nombre-archivo");
    const botonGuardar = document.getElementById("btn-guardar-imagen");

    if (input.files.length > 0) {
      label.textContent = "Archivo seleccionado: " + input.files[0].name;
      botonGuardar.classList.remove("hidden");
    } else {
      label.textContent = "";
      botonGuardar.classList.add("hidden");
    }
  };
</script>
