---
import "../../../styles/Admin/ModalDetallesEvento.css";
---

<div id="modalDetallesReserva" class="modal">
    <div class="modal-contenido">
        <span class="cerrar" onclick="cerrarModalDetallesEvento()">&times;</span
        >
        <div class="detalles-reserva">
            <h2 id="evento-nombre">Nombre del Evento</h2>

            <div class="seccion-detalles centrar">
                <img id="evento-imagen-detalle" class="imagen-curso" />
                <div class="descripcion-completa-container">
                    <p class="descripcion-completa">
                        <strong>Descripción:</strong>
                        <span id="evento-descripcion"></span>
                    </p>
                </div>
            </div>
            <div class="seccion-detalles">
                <h3>Información General</h3>
                <div class="info-grid">
                    <p>
                        <strong>Categoría:</strong>
                        <span id="evento-categoria"></span>
                    </p>
                    <p><strong>Área:</strong> <span id="evento-area"></span></p>
                    <p>
                        <strong>Precio:</strong>
                        <span id="evento-precio"></span>
                    </p>
                    <p>
                        <strong>Es Gratuito:</strong>
                        <span id="evento-es-gratuito"></span>
                    </p>
                    <p>
                        <strong>Es Destacado:</strong>
                        <span id="evento-es-destacado"></span>
                    </p>
                    <p>
                        <strong>Requiere Carta:</strong>
                        <span id="evento-requiere-carta"></span>
                    </p>
                </div>
            </div>

            <div class="seccion-detalles">
                <h3>Fechas de Inscripción</h3>
                <div class="info-grid">
                    <p>
                        <strong>Inicio de Inscripción:</strong>
                        <span id="evento-fecha-inicio-inscripcion"></span>
                    </p>
                    <p>
                        <strong>Fin de Inscripción:</strong>
                        <span id="evento-fecha-fin-inscripcion"></span>
                    </p>
                </div>
            </div>

            <div class="seccion-detalles">
                <h3>Programación</h3>
                <div class="info-grid">
                    <p>
                        <strong>Fecha de Inicio:</strong>
                        <span id="evento-fecha-inicio"></span>
                    </p>
                    <p>
                        <strong>Hora de Inicio:</strong>
                        <span id="evento-hora-inicio"></span>
                    </p>
                    <p>
                        <strong>Fecha de Fin:</strong>
                        <span id="evento-fecha-fin"></span>
                    </p>
                    <p>
                        <strong>Hora de Fin:</strong>
                        <span id="evento-hora-fin"></span>
                    </p>
                    <p>
                        <strong>Duración:</strong>
                        <span id="evento-duracion"></span>
                    </p>
                    <p>
                        <strong>Ubicación:</strong>
                        <span id="evento-ubicacion"></span>
                    </p>
                </div>
            </div>

            <div class="seccion-detalles">
                <h3>Asignación</h3>
                <div class="info-grid">
                    <p>
                        <strong>Asignación:</strong>
                        <span id="evento-asignacion"></span>
                    </p>
                    <p>
                        <strong>Descripción de Asignación:</strong>
                        <span id="evento-asignacion-descripcion"></span>
                    </p>
                </div>
            </div>

            <div
                class="seccion-detalles"
                id="seccion-carta-motivacion"
                style="display: none;"
            >
                <h3>Carta de Motivación</h3>
                <div class="info-detalle">
                    <p>
                        <strong>Instrucciones:</strong>
                    </p>
                    <div class="carta-motivacion-container">
                        <span id="evento-carta-motivacion"></span>
                    </div>
                </div>
            </div>
            <div class="seccion-detalles">
                <h3>Organizador</h3>
                <div class="info-grid">
                    <p>
                        <strong>Cédula:</strong>
                        <span id="organizador-cedula"></span>
                    </p>
                    <p>
                        <strong>Nombre:</strong>
                        <span id="organizador-nombre"></span>
                    </p>
                    <p>
                        <strong>Título Académico:</strong>
                        <span id="organizador-titulo"></span>
                    </p>
                    <p>
                        <strong>Email:</strong>
                        <span id="organizador-email"></span>
                    </p>
                    <p>
                        <strong>Teléfono:</strong>
                        <span id="organizador-telefono"></span>
                    </p>
                </div>
            </div>
            <div class="seccion-detalles">
                <h3>Estado del Evento</h3>
                <div class="info-grid">
                    <p>
                        <strong>Estado:</strong>
                        <span id="evento-estado" class="estado-badge"></span>
                    </p>
                    <p>
                        <strong>Inscripciones:</strong>
                        <span
                            id="evento-estado-inscripciones"
                            class="estado-badge"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .carta-motivacion-container {
        background-color: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px;
        margin-top: 8px;
        font-style: italic;
        line-height: 1.5;
    }

    .info-detalle {
        margin-bottom: 16px;
    }

    .estado-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: bold;
        background-color: #f3f4f6;
        display: inline-block;
    }

    .seccion-detalles h3 {
        color: #374151;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 8px;
        margin-bottom: 16px;
    }

    .info-grid p {
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .info-grid p strong {
        color: #374151;
        min-width: 150px;
    }

    .info-grid p span {
        text-align: right;
        flex: 1;
    }
</style>

<script>
    declare global {
        interface Window {
            cerrarModalDetallesEvento: () => void;
            abrirModalDetallesEvento: (evento: any) => void;
        }
    }

    function cerrarModalDetallesEvento() {
        const modal = document.getElementById("modalDetallesReserva");
        if (modal) modal.style.display = "none";
    }

    function abrirModalDetallesEvento(evento: any) {
        const modal = document.getElementById("modalDetallesReserva");
        if (!modal) return;

        // Poblar el modal con los datos del evento
        poblarModalConDatos(evento);

        modal.style.display = "block";
    }

    function poblarModalConDatos(evento: any) {
        const modal = document.getElementById("modalDetallesReserva");
        if (!modal) return;

        // Actualizar título del modal
        const titulo = modal.querySelector("#evento-nombre");
        if (titulo) titulo.textContent = evento.nom_eve || "Sin nombre";

        // Actualizar descripción
        const descripcion = modal.querySelector("#evento-descripcion");
        if (descripcion)
            descripcion.textContent = evento.des_eve || "Sin descripción";

        // Actualizar imagen
        const imagen = modal.querySelector(
            "#evento-imagen-detalle",
        ) as HTMLImageElement;
        if (imagen) {
            imagen.src =
                evento.img_eve ||
                "https://via.placeholder.com/300x200?text=Sin+Imagen";
            imagen.alt = `Imagen de ${evento.nom_eve}`;
        } // Información General
        const categoria = modal.querySelector("#evento-categoria");
        if (categoria) {
            // Manejar tanto evento.categoria.data como evento.categoria directamente
            const categoriaData =
                evento.categorias_eventos ||
                evento.categoria?.data ||
                evento.categoria;
            categoria.textContent = categoriaData?.nom_cat || "Sin categoría";
        }

        const area = modal.querySelector("#evento-area");
        if (area) area.textContent = evento.are_eve || "No especificada";
        const precio = modal.querySelector("#evento-precio") as HTMLElement;
        if (precio) {
            if (evento.es_gratuito) {
                precio.textContent = "Gratuito";
                precio.style.color = "#059669";
                precio.style.fontWeight = "bold";
            } else {
                precio.textContent = `$${Number(evento.precio || 0).toFixed(2)}`;
            }
        }

        const esGratuito = modal.querySelector(
            "#evento-es-gratuito",
        ) as HTMLElement;
        if (esGratuito) {
            esGratuito.textContent = evento.es_gratuito ? "Sí" : "No";
            esGratuito.style.color = evento.es_gratuito ? "#059669" : "#6b7280";
        }

        const esDestacado = modal.querySelector(
            "#evento-es-destacado",
        ) as HTMLElement;
        if (esDestacado) {
            esDestacado.textContent = evento.es_destacado ? "Sí" : "No";
            esDestacado.style.color = evento.es_destacado
                ? "#dc2626"
                : "#6b7280";
        }

        const requiereCarta = modal.querySelector(
            "#evento-requiere-carta",
        ) as HTMLElement;
        if (requiereCarta) {
            requiereCarta.textContent = evento.requiere_carta ? "Sí" : "No";
            requiereCarta.style.color = evento.requiere_carta
                ? "#dc2626"
                : "#6b7280";
        }

        // Fechas de Inscripción
        const fechaInicioInscripcion = modal.querySelector(
            "#evento-fecha-inicio-inscripcion",
        );
        if (fechaInicioInscripcion) {
            if (evento.fec_ini_ins_eve) {
                const fecha = new Date(evento.fec_ini_ins_eve);
                fechaInicioInscripcion.textContent =
                    fecha.toLocaleDateString("es-ES");
            } else {
                fechaInicioInscripcion.textContent = "No especificada";
            }
        }

        const fechaFinInscripcion = modal.querySelector(
            "#evento-fecha-fin-inscripcion",
        );
        if (fechaFinInscripcion) {
            if (evento.fec_fin_ins_eve) {
                const fecha = new Date(evento.fec_fin_ins_eve);
                fechaFinInscripcion.textContent =
                    fecha.toLocaleDateString("es-ES");
            } else {
                fechaFinInscripcion.textContent = "No especificada";
            }
        }

        // Programación
        const fechaInicio = modal.querySelector("#evento-fecha-inicio");
        if (fechaInicio) {
            const fecha = new Date(evento.fec_ini_eve);
            fechaInicio.textContent = fecha.toLocaleDateString("es-ES");
        }

        const horaInicio = modal.querySelector("#evento-hora-inicio");
        if (horaInicio)
            horaInicio.textContent = evento.hor_ini_eve || "No especificada";

        const fechaFin = modal.querySelector("#evento-fecha-fin");
        if (fechaFin) {
            if (evento.fec_fin_eve) {
                const fecha = new Date(evento.fec_fin_eve);
                fechaFin.textContent = fecha.toLocaleDateString("es-ES");
            } else {
                fechaFin.textContent = "No especificada";
            }
        }

        const horaFin = modal.querySelector("#evento-hora-fin");
        if (horaFin)
            horaFin.textContent = evento.hor_fin_eve || "No especificada";
        const duracion = modal.querySelector("#evento-duracion");
        if (duracion) {
            if (evento.dur_eve) {
                // Mostrar duración en minutos y convertir a horas si es necesario
                if (evento.dur_eve >= 60) {
                    const horas = Math.floor(evento.dur_eve / 60);
                    const minutos = evento.dur_eve % 60;
                    duracion.textContent =
                        minutos > 0
                            ? `${horas}h ${minutos}min (${evento.dur_eve} minutos)`
                            : `${horas}h (${evento.dur_eve} minutos)`;
                } else {
                    duracion.textContent = `${evento.dur_eve} minutos`;
                }
            } else {
                duracion.textContent = "No especificada";
            }
        }

        const ubicacion = modal.querySelector("#evento-ubicacion");
        if (ubicacion)
            ubicacion.textContent = evento.ubi_eve || "No especificada";

        // Asignación
        const asignacion = modal.querySelector("#evento-asignacion");
        if (asignacion) {
            const asignacionData = evento.asignaciones || evento.asignacion;
            asignacion.textContent = asignacionData?.nom_asi || "General";
        }

        const asignacionDescripcion = modal.querySelector(
            "#evento-asignacion-descripcion",
        );
        if (asignacionDescripcion) {
            const asignacionData = evento.asignaciones || evento.asignacion;
            asignacionDescripcion.textContent =
                asignacionData?.des_asi || "Sin descripción específica";
        }

        // Carta de Motivación
        const seccionCartaMotivacion = modal.querySelector(
            "#seccion-carta-motivacion",
        ) as HTMLElement;
        const cartaMotivacion = modal.querySelector("#evento-carta-motivacion");
        if (seccionCartaMotivacion && cartaMotivacion) {
            if (evento.requiere_carta && evento.car_mot_eve) {
                seccionCartaMotivacion.style.display = "block";
                cartaMotivacion.textContent = evento.car_mot_eve;
            } else if (evento.requiere_carta) {
                seccionCartaMotivacion.style.display = "block";
                cartaMotivacion.textContent =
                    "Se requiere carta de motivación pero no se han especificado instrucciones.";
            } else {
                seccionCartaMotivacion.style.display = "none";
            }
        } // Organizador - Cédula
        const organizadorCedula = modal.querySelector("#organizador-cedula");
        if (organizadorCedula) {
            const orgData =
                evento.organizadores ||
                evento.organizador?.data ||
                evento.organizador;
            organizadorCedula.textContent =
                orgData?.ced_org || "No especificada";
        }

        // Organizador - Nombre
        const organizadorNombre = modal.querySelector("#organizador-nombre");
        if (organizadorNombre) {
            const orgData =
                evento.organizadores ||
                evento.organizador?.data ||
                evento.organizador;
            if (orgData) {
                const nombreCompleto =
                    `${orgData.nom_org1} ${orgData.nom_org2 || ""} ${orgData.ape_org1} ${orgData.ape_org2 || ""}`.trim();
                organizadorNombre.textContent = nombreCompleto;
            } else {
                organizadorNombre.textContent = "No especificado";
            }
        }

        // Organizador - Título
        const organizadorTitulo = modal.querySelector("#organizador-titulo");
        if (organizadorTitulo) {
            const orgData =
                evento.organizadores ||
                evento.organizador?.data ||
                evento.organizador;
            organizadorTitulo.textContent =
                orgData?.tit_aca_org || "No especificado";
        }

        // Organizador - Email
        const organizadorEmail = modal.querySelector("#organizador-email");
        if (organizadorEmail) {
            const orgData =
                evento.organizadores ||
                evento.organizador?.data ||
                evento.organizador;
            organizadorEmail.textContent =
                orgData?.ema_org || "No especificado";
        }

        // Organizador - Teléfono
        const organizadorTelefono = modal.querySelector(
            "#organizador-telefono",
        );
        if (organizadorTelefono) {
            const orgData =
                evento.organizadores ||
                evento.organizador?.data ||
                evento.organizador;
            organizadorTelefono.textContent =
                orgData?.tel_org || "No especificado";
        }

        // Estado del Evento
        const estadoEvento = modal.querySelector(
            "#evento-estado",
        ) as HTMLElement;
        if (estadoEvento) {
            const fechaHoy = new Date();
            const fechaInicio = new Date(evento.fec_ini_eve);
            const fechaFin = evento.fec_fin_eve
                ? new Date(evento.fec_fin_eve)
                : fechaInicio;

            let estado = "";
            let color = "";

            if (fechaFin < fechaHoy) {
                estado = "Finalizado";
                color = "#6b7280";
            } else if (fechaInicio <= fechaHoy && fechaFin >= fechaHoy) {
                estado = "En Curso";
                color = "#059669";
            } else {
                estado = "Próximo";
                color = "#3b82f6";
            }

            estadoEvento.textContent = estado;
            estadoEvento.style.color = color;
            estadoEvento.style.fontWeight = "bold";
        }

        // Estado de Inscripciones
        const estadoInscripciones = modal.querySelector(
            "#evento-estado-inscripciones",
        ) as HTMLElement;
        if (estadoInscripciones) {
            const fechaHoy = new Date();
            let estadoInsc = "";
            let colorInsc = "";

            if (evento.fec_ini_ins_eve && evento.fec_fin_ins_eve) {
                const fechaInicioInsc = new Date(evento.fec_ini_ins_eve);
                const fechaFinInsc = new Date(evento.fec_fin_ins_eve);

                if (fechaFinInsc < fechaHoy) {
                    estadoInsc = "Cerradas";
                    colorInsc = "#6b7280";
                } else if (
                    fechaInicioInsc <= fechaHoy &&
                    fechaFinInsc >= fechaHoy
                ) {
                    estadoInsc = "Abiertas";
                    colorInsc = "#059669";
                } else if (fechaInicioInsc > fechaHoy) {
                    estadoInsc = "Próximamente";
                    colorInsc = "#f59e0b";
                } else {
                    estadoInsc = "No definidas";
                    colorInsc = "#6b7280";
                }
            } else {
                estadoInsc = "No definidas";
                colorInsc = "#6b7280";
            }

            estadoInscripciones.textContent = estadoInsc;
            estadoInscripciones.style.color = colorInsc;
            estadoInscripciones.style.fontWeight = "bold";
        }
    } // Cerrar modal al hacer clic fuera de él
    window.onclick = function (event) {
        const modal = document.getElementById("modalDetallesReserva");
        if (event.target === modal) {
            cerrarModalDetallesEvento();
        }
    }; // Exponer funciones globalmente
    window.cerrarModalDetallesEvento = cerrarModalDetallesEvento;
    window.abrirModalDetallesEvento = abrirModalDetallesEvento;
</script>
