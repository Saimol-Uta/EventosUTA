---
import InformacionUsuarioItem from "../components/InformacionUsuarioItem.astro";
import InformacionUsuario from "../components/InformacionUsuario.astro";
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Navbar from "../components/Navbar.astro";

const method = Astro.request.method;
let cedulaIngresada = "";
let mostrarFormulario = false;
let mostrarError = false;

if (method === "POST") {
  const formData = await Astro.request.formData();
  cedulaIngresada = formData.get("ced_usu")?.toString() ?? "";

  if (/^\d{10}$/.test(cedulaIngresada)) {
    mostrarFormulario = true;
  } else {
    mostrarError = true;
  }
}

const camposFormulario = [
  { titulo: "Cédula", valor: cedulaIngresada, name: "ced_usu" },
  { titulo: "Primer nombre", valor: "Juan", name: "nom_usu1" },
  { titulo: "Segundo nombre", valor: "Carlos", name: "nom_usu2" },
  { titulo: "Primer apellido", valor: "Pérez", name: "ape_usu1" },
  { titulo: "Segundo apellido", valor: "García", name: "ape_usu2" },
  { titulo: "Fecha de nacimiento", valor: "1998-04-20", name: "fec_nac_usu" },
  { titulo: "Teléfono", valor: "0987654321", name: "num_tel_usu" },
  { titulo: "Contraseña", valor: "", name: "contrasena" },
  { titulo: "Carrera", valor: "carrera-id-123", name: "id_car_per" }
];
---

<Layout>
  <Header />
  <Navbar />

  <div class="bg-gray-100 min-h-screen py-10">
    <div class="max-w-3xl mx-auto px-4 text-center">

      {mostrarFormulario ? (
        <InformacionUsuario camposFormulario={camposFormulario} />
      ) : (
        <form method="POST" class="formulario-container formulario-grid">
          <div class="campo-item">
            <label for="ced_usu">Ingrese su numero de Cédula</label>
            <input
              type="text"
              id="ced_usu"
              name="ced_usu"
              value={cedulaIngresada}
              placeholder="Ej. 0101010101"
              required
            />
          </div>

          <div class="formulario-boton">
            <button type="submit">Continuar</button>
          </div>

          {mostrarError && (
            <p class="text-red-600 text-sm mt-2" style="grid-column: 1 / -1;">
              Cédula inválida o no encontrada
            </p>
          )}
        </form>
      )}
    </div>
  </div>
</Layout>

<style>
.formulario-container {
  background-color: #eee;
  border-radius: 8px;
  padding: 2rem;
  max-width: 500px;
  margin: 2rem auto;
  font-family: 'Segoe UI', sans-serif;
  box-shadow: 0 0 4px rgba(0,0,0,0.1);
}

.formulario-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
}

.campo-item {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.campo-item label {
  font-weight: bold;
  color: #8B0000;
  font-size: 14px;
}

.campo-item input {
  padding: 10px;
  font-size: 15px;
  border: 1px solid #ccc;
  border-radius: 6px;
  outline: none;
}

.campo-item input:focus {
  border-color: #8B0000;
  box-shadow: 0 0 0 2px rgba(139, 0, 0, 0.2);
}

.formulario-boton {
  text-align: center;
}

.formulario-boton button {
  background-color: #8B0000;
  color: white;
  font-size: 16px;
  padding: 10px 30px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.formulario-boton button:hover {
  background-color: #a00;
}
</style>

