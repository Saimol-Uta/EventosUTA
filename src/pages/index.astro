---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import InformacionFacultad from "../components/InformacionFacultad.astro";
import Footer from "../components/Footer.astro";
import Navbar from "../components/Navbar.astro";
import type { CustomUser } from "../../auth.config";
import { getSession } from "auth-astro/server";
import InformacionUsuario from "@/components/InformacionUsuario.astro";
import ContenedorInfo from "@/components/ContenedorInfo.astro";
import prisma from "@/db";

const session = await getSession(Astro.request);
let esAdmin = false;

if (session && session.user) {
    const user = session.user as CustomUser;
    const rol = user.rol?.toUpperCase();
    if (rol === "ADMINISTRADOR" || rol === "MASTER") {
        esAdmin = true;
    }
}

const pagina = await prisma.pagina_principal.findUnique({
    where: { id_pag: 1 },
});
---

<Layout>
    <Header />
    <Navbar />
    <InformacionFacultad
        tituloFacultad="Facultad de Ciencias de la Computaci贸n"
        tituloDescripcion="Descripci贸n"
        contenidoDescripcion={pagina?.des_pag ?? ""}
        imagenDescripcion="https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=800&q=80"
        tituloMision="Misi贸n"
        contenidoMision={pagina?.mis_pag ?? ""}
        imagenMision="https://images.unsplash.com/photo-1461749280684-dccba630e2f6?auto=format&fit=crop&w=800&q=80"
        tituloVision="Visi贸n"
        contenidoVision={pagina?.vis_pag ?? ""}
        imagenVision="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=800&q=80"
        modoAdmin={esAdmin}
    />
    <Footer />
</Layout>
